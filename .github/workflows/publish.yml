 name: Build and publish to PyPI

 on:
   push:
     tags:
       - 'v*'
   release:
     types: [published]

 jobs:
   build-and-publish:
     runs-on: ubuntu-latest
     permissions:
       contents: read
     steps:
       - name: Check out repository
         uses: actions/checkout@v4

       - name: Set up Python
         uses: actions/setup-python@v5
         with:
           python-version: '3.x'

       - name: Install build tools
         run: |
           python -m pip install --upgrade pip
           python -m pip install build

       - name: Build distributions
         run: python -m build

       - name: Publish to PyPI
         if: startsWith(github.ref, 'refs/tags/v') || github.event_name == 'release'
         uses: pypa/gh-action-pypi-publish@release/v1
         with:
           user: __token__
           password: ${{ secrets.PYPI_API_TOKEN }}
           verbose: true
           skip-existing: true


